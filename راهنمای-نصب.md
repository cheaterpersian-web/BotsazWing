# راهنمای نصب پلتفرم تلگرام بات SaaS

## 🚀 نصب سریع (توصیه می‌شود)

برای نصب سریع و آسان:

```bash
./quick-install.sh
```

این اسکریپت فقط اطلاعات ضروری را می‌پرسد:
- توکن بات تلگرام
- شناسه تلگرام شما
- شماره حساب بانکی
- آدرس کیف پول کریپتو

## 🔧 نصب کامل با تنظیمات پیشرفته

برای نصب با تمام گزینه‌ها:

```bash
./install-fa.sh
```

این اسکریپت شامل:
- تنظیمات دامنه سفارشی
- گواهی SSL
- تنظیمات مانیتورینگ
- پشتیبان‌گیری خودکار

## 📋 پیش‌نیازها

### سیستم عامل
- Ubuntu 20.04+ (توصیه می‌شود)
- CentOS 8+
- Debian 10+
- یا هر توزیع لینوکس با Docker

### سخت‌افزار
- حداقل 4GB RAM
- 2 CPU Core
- 20GB فضای خالی

### نرم‌افزار
- Docker
- Docker Compose
- Git
- curl

## 🛠️ نصب پیش‌نیازها

### نصب Docker
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
```

### نصب Docker Compose
```bash
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### نصب Git
```bash
sudo apt update
sudo apt install git -y
```

## 📱 دریافت اطلاعات مورد نیاز

### 1. توکن بات تلگرام
1. به [@BotFather](https://t.me/BotFather) پیام دهید
2. دستور `/newbot` را ارسال کنید
3. نام و نام کاربری بات را وارد کنید
4. توکن دریافتی را کپی کنید

### 2. شناسه تلگرام شما
1. به [@userinfobot](https://t.me/userinfobot) پیام دهید
2. شناسه عددی خود را کپی کنید

### 3. اطلاعات پرداخت
- شماره حساب بانکی برای دریافت پرداخت‌ها
- آدرس کیف پول کریپتو (اختیاری)

## 🎯 مراحل نصب

### مرحله 1: دریافت کد
```bash
git clone <repository-url>
cd telegram-bot-saas
```

### مرحله 2: اجرای نصب
```bash
# نصب سریع
./quick-install.sh

# یا نصب کامل
./install-fa.sh
```

### مرحله 3: انتظار
نصب معمولاً 5-10 دقیقه طول می‌کشد.

### مرحله 4: دسترسی
- داشبورد ادمین: `http://localhost:3000`
- API: `http://localhost:8000/docs`

## 🔐 ورود به سیستم

1. به `http://localhost:3000` بروید
2. شناسه تلگرام خود را وارد کنید
3. اطلاعات تکمیلی را پر کنید
4. وارد داشبورد شوید

## 📊 مانیتورینگ

### Grafana
- آدرس: `http://localhost:3001`
- کاربری: `admin`
- رمز عبور: در فایل `.env` موجود است

### Prometheus
- آدرس: `http://localhost:9090`

### MinIO (ذخیره فایل)
- آدرس: `http://localhost:9001`
- اطلاعات ورود در فایل `.env`

## 🛠️ مدیریت سیستم

### مشاهده وضعیت سرویس‌ها
```bash
docker-compose ps
```

### مشاهده لاگ‌ها
```bash
# همه سرویس‌ها
docker-compose logs -f

# سرویس خاص
docker-compose logs -f backend
docker-compose logs -f bot
```

### راه‌اندازی مجدد
```bash
docker-compose restart
```

### توقف سرویس‌ها
```bash
docker-compose down
```

### راه‌اندازی مجدد
```bash
docker-compose up -d
```

## 💾 پشتیبان‌گیری

### پشتیبان‌گیری دستی
```bash
./backup.sh
```

### پشتیبان‌گیری خودکار
```bash
# اضافه کردن به crontab
crontab -e

# پشتیبان‌گیری روزانه ساعت 2 صبح
0 2 * * * /path/to/backup.sh
```

## 🔄 به‌روزرسانی

```bash
./update.sh
```

## 🚨 عیب‌یابی

### مشکل: سرویس‌ها راه‌اندازی نمی‌شوند
```bash
# بررسی لاگ‌ها
docker-compose logs

# بررسی منابع سیستم
docker stats

# راه‌اندازی مجدد
docker-compose restart
```

### مشکل: بات پاسخ نمی‌دهد
1. توکن بات را بررسی کنید
2. وب‌هوک را بررسی کنید:
```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
```

### مشکل: دیتابیس متصل نمی‌شود
```bash
# بررسی وضعیت دیتابیس
docker-compose exec postgres pg_isready -U telegram_bot_user

# اتصال به دیتابیس
docker-compose exec postgres psql -U telegram_bot_user -d telegram_bot_saas
```

### مشکل: فرانت‌اند لود نمی‌شود
```bash
# بررسی سرویس فرانت‌اند
docker-compose logs frontend

# بررسی اتصال API
curl http://localhost:8000/health
```

## 📞 پشتیبانی

### لاگ‌های مفید برای گزارش مشکل
```bash
# وضعیت کلی
docker-compose ps

# لاگ‌های مهم
docker-compose logs --tail=50 backend
docker-compose logs --tail=50 bot
docker-compose logs --tail=50 postgres

# وضعیت سیستم
df -h
free -h
docker system df
```

### اطلاعات سیستم
```bash
# نسخه‌ها
docker --version
docker-compose --version
uname -a

# تنظیمات
cat .env | grep -v PASSWORD
```

## 🎉 پس از نصب

1. **تست بات**: به بات خود در تلگرام `/start` ارسال کنید
2. **ایجاد بات جدید**: از طریق بات اصلی یک بات جدید بسازید
3. **تست پرداخت**: یک پرداخت تستی انجام دهید
4. **بررسی مانیتورینگ**: به Grafana بروید و نمودارها را بررسی کنید

## 🔒 امنیت

### تنظیمات امنیتی مهم
1. فایل `.env` را محافظت کنید
2. رمزهای عبور را تغییر دهید
3. فایروال را تنظیم کنید
4. به‌روزرسانی‌های امنیتی را نصب کنید

### فایروال
```bash
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443
sudo ufw deny 8000
sudo ufw deny 3000
```

## 📈 بهینه‌سازی

### تنظیمات Docker
```bash
# افزایش حافظه Docker
sudo nano /etc/docker/daemon.json
```

```json
{
  "default-ulimits": {
    "memlock": {
      "Hard": -1,
      "Name": "memlock",
      "Soft": -1
    }
  },
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
```

### تنظیمات سیستم
```bash
# افزایش محدودیت فایل
echo "* soft nofile 65536" | sudo tee -a /etc/security/limits.conf
echo "* hard nofile 65536" | sudo tee -a /etc/security/limits.conf
```

## 🎯 نکات مهم

1. **همیشه پشتیبان بگیرید** قبل از تغییرات مهم
2. **منابع سیستم را مانیتور کنید** تا از کمبود حافظه جلوگیری کنید
3. **لاگ‌ها را بررسی کنید** برای شناسایی مشکلات
4. **به‌روزرسانی‌ها را نصب کنید** برای امنیت بیشتر
5. **تنظیمات را تست کنید** قبل از استفاده در تولید

---

**موفق باشید! 🚀**